<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Almoxarifado</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        form { margin-bottom: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Controle de Almoxarifado</h1>
    
    <form id="formLancamento">
        <label for="item">Nome do Material:</label>
        <input type="text" id="item" required><br><br>
        
        <label for="quantidade">Quantidade:</label>
        <input type="number" id="quantidade" min="1" required><br><br>
        
        <label for="tipo">Tipo:</label>
        <select id="tipo" required>
            <option value="entrada">Entrada</option>
            <option value="retirada">Retirada</option>
        </select><br><br>
        
        <!-- NOVO: Campo para inserir a data específica -->
        <label for="data">Data (de chegada ou retirada):</label>
        <input type="date" id="data" required><br><br>
        
        <button type="submit">Lançar</button>
    </form>
    
    <button id="gerarRelatorio">Gerar Relatório Semanal</button>
    
    <div id="relatorio" style="display: none;">
        <h2>Relatório da Semana</h2>
        <table id="tabelaRelatorio">
            <thead>
                <tr>
                    <th>Material</th>
                    <th>Total Entradas</th>
                    <th>Total Retiradas</th>
                    <th>Saldo Líquido</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        const form = document.getElementById('formLancamento');
        const gerarBtn = document.getElementById('gerarRelatorio');
        const relatorioDiv = document.getElementById('relatorio');
        const tabelaBody = document.querySelector('#tabelaRelatorio tbody');

        // Carregar lançamentos do localStorage
        let lancamentos = JSON.parse(localStorage.getItem('lancamentos')) || [];

        // Função para salvar lançamentos
        function salvarLancamentos() {
            localStorage.setItem('lancamentos', JSON.stringify(lancamentos));
        }

        // Lidar com submissão do formulário
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const item = document.getElementById('item').value;
            const quantidade = parseInt(document.getElementById('quantidade').value);
            const tipo = document.getElementById('tipo').value;
            // ALTERADO: Pegar a data do input em vez de usar a data atual
            const data = document.getElementById('data').value;

            lancamentos.push({ item, quantidade, tipo, data });
            salvarLancamentos();
            form.reset();
            alert('Lançamento registrado!');
        });

        // Função para gerar relatório semanal (sem alterações na lógica de filtro)
        gerarBtn.addEventListener('click', () => {
            const hoje = new Date();
            const inicioSemana = new Date(hoje);
            inicioSemana.setDate(hoje.getDate() - hoje.getDay()); // Domingo da semana atual
            const fimSemana = new Date(inicioSemana);
            fimSemana.setDate(inicioSemana.getDate() + 6); // Sábado

            const lancamentosSemana = lancamentos.filter(l => {
                const dataLanc = new Date(l.data);
                return dataLanc >= inicioSemana && dataLanc <= fimSemana;
            });

            // Agrupar por item
            const resumo = {};
            lancamentosSemana.forEach(l => {
                if (!resumo[l.item]) resumo[l.item] = { entradas: 0, retiradas: 0 };
                if (l.tipo === 'entrada') resumo[l.item].entradas += l.quantidade;
                else resumo[l.item].retiradas += l.quantidade;
            });

            // Limpar tabela e preencher
            tabelaBody.innerHTML = '';
            for (const [item, dados] of Object.entries(resumo)) {
                const saldo = dados.entradas - dados.retiradas;
                const row = tabelaBody.insertRow();
                row.insertCell(0).textContent = item;
                row.insertCell(1).textContent = dados.entradas;
                row.insertCell(2).textContent = dados.retiradas;
                row.insertCell(3).textContent = saldo;
            }

            relatorioDiv.style.display = 'block';
        });
    </script>
</body>
</html>